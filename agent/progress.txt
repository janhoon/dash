# Progress Log

This file tracks progress on the dash project features.

## Setup - Project Architecture & Foundation - 2026-02-02
- What was done:
  - Created Vue.js 3 frontend with TypeScript and Vite (port 5173)
  - Set up Vitest for frontend testing with happy-dom environment
  - Created Go backend with pgx PostgreSQL driver
  - Set up Go project structure: cmd/api, internal/handlers, internal/models, internal/db, pkg
  - Created docker-compose.yml with PostgreSQL and Prometheus services
  - Implemented database migrations for dashboards, panels, and data_sources tables
  - Added CORS middleware to Go API
  - Created GET /api/health endpoint returning 200 OK with JSON response
  - Added comprehensive .gitignore
  - Updated README.md with setup instructions
- Files changed:
  - frontend/ - entire Vue.js 3 project scaffolded
  - frontend/src/App.vue - simplified dashboard landing page
  - frontend/src/App.spec.ts - basic test for App component
  - frontend/vite.config.ts - added vitest configuration
  - frontend/package.json - added test and type-check scripts
  - backend/cmd/api/main.go - API server with graceful shutdown
  - backend/internal/handlers/health.go - health check handler
  - backend/internal/handlers/health_test.go - health check tests
  - backend/internal/db/db.go - database connection with pgx
  - backend/internal/db/migrations.go - schema migrations
  - docker-compose.yml - PostgreSQL and Prometheus services
  - prometheus.yml - Prometheus configuration
  - .gitignore - project-wide ignore rules
  - README.md - setup instructions
- Blockers/notes for next iteration:
  - None. Ready to proceed with Dashboard CRUD Operations.

## Core - Dashboard CRUD Operations - 2026-02-02
- What was done:
  - Created Dashboard model in Go (internal/models/dashboard.go)
  - Implemented full CRUD handlers for dashboards:
    - POST /api/dashboards (create with title, description, user_id)
    - GET /api/dashboards (list all dashboards)
    - GET /api/dashboards/{id} (get single dashboard)
    - PUT /api/dashboards/{id} (update title/description)
    - DELETE /api/dashboards/{id} (delete with 204 response)
  - Added google/uuid dependency for UUID parsing
  - Created frontend types (types/dashboard.ts)
  - Created API client (api/dashboards.ts) with fetch-based CRUD functions
  - Set up Vue Router with /dashboards route
  - Created DashboardList.vue component with:
    - Dashboard grid display
    - Loading/error/empty states
    - Create, edit, delete functionality
  - Created CreateDashboardModal.vue with form validation
  - Created EditDashboardModal.vue for updating dashboards
  - Added delete confirmation dialog
  - Updated App.vue to use RouterView
  - Added comprehensive tests (27 frontend tests, all passing)
- Files changed:
  - backend/internal/models/dashboard.go (new)
  - backend/internal/handlers/dashboards.go (new)
  - backend/internal/handlers/dashboards_test.go (new)
  - backend/cmd/api/main.go - added dashboard routes
  - backend/go.mod, go.sum - added google/uuid
  - frontend/src/types/dashboard.ts (new)
  - frontend/src/api/dashboards.ts (new)
  - frontend/src/api/dashboards.spec.ts (new)
  - frontend/src/components/DashboardList.vue (new)
  - frontend/src/components/DashboardList.spec.ts (new)
  - frontend/src/components/CreateDashboardModal.vue (new)
  - frontend/src/components/CreateDashboardModal.spec.ts (new)
  - frontend/src/components/EditDashboardModal.vue (new)
  - frontend/src/components/EditDashboardModal.spec.ts (new)
  - frontend/src/views/DashboardsView.vue (new)
  - frontend/src/router/index.ts (new)
  - frontend/src/main.ts - added router
  - frontend/src/App.vue - updated to use RouterView
  - frontend/src/App.spec.ts - updated for RouterView
  - frontend/package.json - added vue-router
- Blockers/notes for next iteration:
  - None. Ready to proceed with Panel System feature.

## Core - Panel System (Simple Container) - 2026-02-02
- What was done:
  - Created Panel model in Go (internal/models/panel.go) with GridPos struct
  - Implemented full CRUD handlers for panels:
    - POST /api/dashboards/{id}/panels (create panel with grid_pos)
    - GET /api/dashboards/{id}/panels (list panels for dashboard)
    - PUT /api/panels/{id} (update panel title, type, grid_pos, query)
    - DELETE /api/panels/{id} (delete with 204 response)
  - Panels table migration already existed from Sprint 1
  - Created frontend types (types/panel.ts) with GridPos interface
  - Created API client (api/panels.ts) with fetch-based CRUD functions
  - Created Panel.vue component:
    - Simple card with title header and content slot
    - Edit and delete action buttons
    - Placeholder for visualization content
  - Created PanelEditModal.vue:
    - Form for panel title, type (dropdown), and query (JSON)
    - JSON validation for query field
    - Works for both create and edit modes
  - Created DashboardDetailView.vue:
    - Displays dashboard with all panels
    - 12-column CSS grid layout based on grid_pos
    - Add Panel button with modal
    - Edit and delete panel actions with confirmation
    - Back navigation to dashboard list
  - Updated DashboardList.vue:
    - Made dashboard cards clickable to navigate to detail view
    - Added useRouter for navigation
  - Added /dashboards/:id route to Vue Router
  - Added comprehensive tests:
    - Backend: 10 tests for panel handlers (validation, UUID parsing, JSON)
    - Frontend: 22 new tests for panel API and components
    - All 49 frontend tests passing
    - All backend tests passing
- Files changed:
  - backend/internal/models/panel.go (new)
  - backend/internal/handlers/panels.go (new)
  - backend/internal/handlers/panels_test.go (new)
  - backend/cmd/api/main.go - added panel routes
  - frontend/src/types/panel.ts (new)
  - frontend/src/api/panels.ts (new)
  - frontend/src/api/panels.spec.ts (new)
  - frontend/src/components/Panel.vue (new)
  - frontend/src/components/Panel.spec.ts (new)
  - frontend/src/components/PanelEditModal.vue (new)
  - frontend/src/components/PanelEditModal.spec.ts (new)
  - frontend/src/views/DashboardDetailView.vue (new)
  - frontend/src/router/index.ts - added dashboard detail route
  - frontend/src/components/DashboardList.vue - made cards clickable
- Blockers/notes for next iteration:
  - None. Ready to proceed with Time Range Picker Component.

## UI - Time Range Picker Component - 2026-02-02
- What was done:
  - Created useTimeRange.ts composable with:
    - Reactive start/end timestamps calculation
    - All 7 preset ranges (5m, 15m, 30m, 1h, 6h, 24h, 7d)
    - Custom range support with date pickers
    - Auto-refresh with intervals (Off, 5s, 15s, 30s, 1m)
    - Shared state across components using the composable
    - onRefresh callback system for panel data refresh
  - Created TimeRangePicker.vue component with:
    - Dropdown UI for selecting time ranges
    - Quick range presets list with visual selection indicator
    - Custom range form with datetime-local inputs
    - Validation for custom ranges (start < end)
    - Refresh interval selector (dropdown)
    - Manual refresh button
    - Human-readable display text (e.g., "Last 5 minutes")
  - Integrated TimeRangePicker into DashboardDetailView:
    - Added to header alongside "Add Panel" button
    - Connected to useTimeRange composable for shared state
    - Set up refresh callback subscription for panel data updates
    - Proper cleanup on unmount
  - Added comprehensive tests:
    - 23 tests for useTimeRange composable
    - 13 tests for TimeRangePicker component
    - All 85 frontend tests passing
    - All backend tests passing
- Files changed:
  - frontend/src/composables/useTimeRange.ts (new)
  - frontend/src/composables/useTimeRange.spec.ts (new)
  - frontend/src/components/TimeRangePicker.vue (new)
  - frontend/src/components/TimeRangePicker.spec.ts (new)
  - frontend/src/views/DashboardDetailView.vue - integrated TimeRangePicker
- Blockers/notes for next iteration:
  - None. Ready to proceed with Prometheus Data Source Integration.

## Data - Prometheus Data Source Integration - 2026-02-02
- What was done:
  - Fixed build error in pkg/prometheus/client.go (ValueType string conversion)
  - Backend already had:
    - Prometheus Go client dependency (github.com/prometheus/client_golang)
    - DataSource model in internal/models/datasource.go
    - Prometheus client wrapper in pkg/prometheus/client.go
    - GET /api/datasources/prometheus/query endpoint
    - Query endpoint accepts: query (PromQL), start, end, step parameters
    - Proper error handling and HTTP status codes
  - Created frontend useProm.ts composable with:
    - TypeScript types for Prometheus API response
    - queryPrometheus() function to fetch data from backend API
    - transformToChartData() to convert Prometheus response to chart-friendly format
    - useProm() composable with reactive loading/error states
    - Auto-fetch capability when query parameters change
    - Support for custom step intervals
  - Added comprehensive tests:
    - 5 backend tests for Prometheus handler validation
    - 21 frontend tests for useProm composable
    - Tests cover: data transformation, error handling, loading states, auto-fetch
    - All 106 frontend tests passing
    - All backend tests passing
- Files changed:
  - backend/pkg/prometheus/client.go - fixed ValueType.String() call
  - frontend/src/composables/useProm.ts (new)
  - frontend/src/composables/useProm.spec.ts (new)
- Blockers/notes for next iteration:
  - None. Ready to proceed with PromQL Query Editor.

## UI - PromQL Query Editor - 2026-02-02
- What was done:
  - Added missing Prometheus query API endpoint to backend:
    - GET /api/datasources/prometheus/query handler
    - Accepts query, start, end, step parameters
    - Returns JSON format with status, data, error
    - Backend tests for parameter validation
  - Created QueryEditor.vue component with:
    - Textarea for PromQL input with monospace font
    - "Run Query" button to test queries before saving
    - Ctrl+Enter keyboard shortcut to run query
    - Error display for invalid queries (from Prometheus API)
    - Query results preview section showing:
      - Number of series returned
      - Metric labels extracted from results
      - Table with metric, latest value, and data point count
    - Loading state during query execution
    - Clears results when query changes
  - Integrated QueryEditor into PanelEditModal:
    - Replaced JSON textarea with QueryEditor component
    - Panel query now stored as { promql: "..." } format
    - Query loaded from panel config when editing
    - Works for both create and edit panel modes
  - Added comprehensive tests:
    - 16 tests for QueryEditor component
    - 9 updated tests for PanelEditModal with QueryEditor integration
    - All 122 frontend tests passing
    - All backend tests passing
- Files changed:
  - backend/internal/handlers/prometheus.go (new)
  - backend/internal/handlers/prometheus_test.go (new)
  - backend/internal/models/datasource.go (new)
  - backend/cmd/api/main.go - added Prometheus route
  - backend/go.mod, go.sum - added Prometheus dependencies
  - frontend/src/components/QueryEditor.vue (new)
  - frontend/src/components/QueryEditor.spec.ts (new)
  - frontend/src/components/PanelEditModal.vue - integrated QueryEditor
  - frontend/src/components/PanelEditModal.spec.ts - updated tests
- PR: (pending)
- Blockers/notes for next iteration:
  - None. Ready to proceed with Line Chart Component.

## Feature - Auto-Refresh for Panels - 2026-02-02
- What was done:
  - Enhanced useTimeRange.ts composable with:
    - isRefreshing state to track refresh operations
    - isPaused state to support pause/resume during panel editing
    - pauseAutoRefresh() function to stop auto-refresh
    - resumeAutoRefresh() function to resume auto-refresh
    - triggerRefresh() async function for consistent refresh behavior
  - Enhanced TimeRangePicker.vue with:
    - Refresh status indicator showing "Refreshing..." or last refresh time
    - Last refresh timestamp in refresh button tooltip
    - Animated refresh button with spinning icon during refresh
    - Conditional display of refresh status based on interval setting
  - Integrated pause/resume into DashboardDetailView.vue:
    - Auto-refresh pauses when opening panel edit modal
    - Auto-refresh resumes when closing panel edit modal
    - Works for both add new panel and edit existing panel flows
  - Added 5m refresh interval option to REFRESH_INTERVALS
  - Added comprehensive tests:
    - pauseAutoRefresh test (stops auto-refresh and sets isPaused)
    - resumeAutoRefresh test (resumes auto-refresh and clears isPaused)
    - resumeAutoRefresh with interval off test
    - TimeRangePicker tests for refresh status, animation, and tooltip
    - All 125 frontend tests passing
    - All backend tests passing
- Files changed:
  - frontend/src/composables/useTimeRange.ts - added pause/resume, isRefreshing, isPaused
  - frontend/src/composables/useTimeRange.spec.ts - added pause/resume tests
  - frontend/src/components/TimeRangePicker.vue - added refresh indicator UI
  - frontend/src/components/TimeRangePicker.spec.ts - added refresh UI tests
  - frontend/src/views/DashboardDetailView.vue - integrated pause/resume on modal open/close
- Blockers/notes for next iteration:
  - None. Ready to proceed with Dashboard Grid Layout.
